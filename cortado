#!/bin/bash

function compile_x86 {
	echo "Compiling for X86 backend.."
	
	java -cp mjc.jar:lib/JFlex.jar:lib/java-cup-11a.jar mjc.X86Main $1 -S
}

function compile_jasmin {
	echo "Compiling for JASMIN backend.."

	rm -f cortadoout/*.s
	rm -f cortadoout/*.o
	rm -f cortadoout/*.class
	rm -f cortadoout/*.j
	rm -f cortadoout/*.out

	java -cp mjc.jar:lib/JFlex.jar:lib/java-cup-11a.jar mjc.JVMMain $1 -S
	
	dir=$( dirname $1 )
	mkdir -p cortadoout/$dir 2> /dev/null
	mv *.j cortadoout/$dir
	java -jar lib/jasmin.jar cortadoout/$dir/*.j -d cortadoout/$dir
}

if [ "$1" == "--target=x86" ]; then
	compile_x86 $2
elif [ "$1" == "--target=jasmin" ]; then
	compile_jasmin $2
else
	echo "Usage: cortado --target=(x86 | jasmin) source_file.java"
fi

